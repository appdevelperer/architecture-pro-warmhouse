@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml

title Контейнерная диаграмма: Взаимодействие Bounded Contexts (DDD)

Person(user, "Пользователь")

Container(web_app, "Веб-приложение", "React", "Интерфейс для управления устройствами, сценариями, покупками")
Container(mobile_app, "Мобильное приложение", "iOS/Android", "Управление в реальном времени")

Container(user_mgmt, "User Management", "Go/Java", "Управление аккаунтами и доступом")
Container(device_mgmt, "Device Management", "Go/Java", "Регистрация и управление устройствами")
Container(scenario_engine, "Scenario Engine", "Go/Java", "Выполнение автоматизированных сценариев")
Container(telemetry_svc, "Telemetry Service", "Go + TSDB", "Сбор и хранение телеметрии")
Container(catalog_svc, "Product Catalog", "Go", "Продажа и активация комплектов")
Container(integration_gateway, "Integration Gateway", "Go", "Интеграция с устройствами партнёров")

Rel(user, web_app, "Управляет, настраивает, покупает")
Rel(user, mobile_app, "Управляет в реальном времени")

Rel(web_app, user_mgmt, "Аутентификация, управление профилем", "HTTP")
Rel(web_app, device_mgmt, "Просмотр/управление устройствами", "HTTP")
Rel(web_app, scenario_engine, "Создание/редактирование сценариев", "HTTP")
Rel(web_app, telemetry_svc, "Просмотр истории и графиков", "WebSocket/HTTP")
Rel(web_app, catalog_svc, "Покупка комплектов", "HTTP")

Rel(mobile_app, device_mgmt, "Отправка команд", "WebSocket/HTTP")
Rel(mobile_app, telemetry_svc, "Получение телеметрии в реалтайме", "WebSocket")

Rel(device_mgmt, integration_gateway, "Отправка команд устройствам", "gRPC/HTTP")
Rel(integration_gateway, device_mgmt, "Получение статуса/событий от устройств", "Callback/HTTP")

Rel(scenario_engine, device_mgmt, "Отправка команд по сценариям", "HTTP")
Rel(scenario_engine, telemetry_svc, "Чтение условий (например, температура)", "HTTP")

Rel(catalog_svc, device_mgmt, "Активация купленных модулей", "HTTP")

@enduml